<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>지하철 실시간 도착 정보</title>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?clientId=YOUR_NAVER_CLIENT_ID"></script> <!-- 네이버 지도 API -->
</head>
<body>
    <h1>실시간 지하철 도착 정보</h1>
    <input type="text" id="stationName" placeholder="지하철 역을 입력하세요">
    <button onclick="fetchStationData()">검색</button>

    <div id="map" style="width: 800px; height: 600px;"></div> <!-- 네이버 지도 표시 영역 -->
    
    <script>
        let map;
        let markers = [];

        // 지도 초기화
        function initMap() {
            map = new naver.maps.Map('map', {
                center: new naver.maps.LatLng(37.5665, 126.9780), // 서울의 중심 좌표
                zoom: 12
            });
        }

        // 실시간 도착 정보 요청 함수
        function fetchStationData() {
            const stationName = document.getElementById("stationName").value;
            if (!stationName) {
                alert('역 이름을 입력하세요.');
                return;
            }

            fetch('http://localhost:3000/station_name', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ stationName: stationName })
            })
            .then(response => response.json())
            .then(data => {
                if (data && data.length > 0) {
                    showTrainsOnMap(data); // 지도에 전철 표시
                } else {
                    alert('해당 역에 대한 실시간 정보가 없습니다.');
                }
            })
            .catch(error => {
                console.error('Error fetching data:', error);
                alert('데이터를 불러오는 중 오류가 발생했습니다.');
            });
        }

        // 전철의 실시간 위치를 지도에 표시하는 함수
        function showTrainsOnMap(trainData) {
            // 기존 마커 제거
            markers.forEach(marker => marker.setMap(null));
            markers = [];

            trainData.forEach(train => {
                const latLng = new naver.maps.LatLng(train.latitude, train.longitude); // 위도, 경도는 응답 데이터에서 제공되어야 합니다.
                
                const marker = new naver.maps.Marker({
                    position: latLng,
                    map: map,
                    title: `${train.trainLineNm} ${train.trainNo}열차`
                });

                markers.push(marker); // 마커 목록에 추가
            });
        }

        // 페이지가 로드되면 지도를 초기화합니다.
        window.onload = initMap;
    </script>
</body>
</html>
